#include <stdio.h>
#include <stdlib.h>
#include <openssl/evp.h>
#include <string.h>

#define AES_BLOCK_SIZE 128

int main(){
    u_char key[AES_BLOCK_SIZE / 8] = {0,1,2,3,4,5,6,7,0,1,2,3,4,5,6,7};
    u_char ciphered[AES_BLOCK_SIZE]={
        0x8b,0x75,0x35,0xa8,0xf9,0x65,0x0d,0x3f,0x5a,0xb7,0xe1,0xdb,0x2d,0xc8,0xb9,0x24,
        0xee,0x9f,0x86,0xee,0x7b,0x69,0x1c,0xb4,0x73,0x62,0xd3,0x34,0x49,0xa0,0x19,0xe9,
        0x7d,0x38,0x7b,0xfe,0x0e,0x3b,0x91,0xaa,0x62,0xf7,0x82,0x98,0xd1,0x29,0x95,0x6d,
        0x68,0x5d,0x2f,0x2f,0xbc,0xef,0x68,0x7e,0xf7,0x5c,0xaf,0x8a,0x44,0xa6,0xb4,0xbd,
        0x7d,0xdc,0x23,0xa9,0x36,0x74,0xbf,0x1c,0x1b,0x92,0xa2,0x30,0xc0,0x53,0x71,0xf0,
        0xf3,0x75,0x5c,0xae,0x59,0xc9,0xf5,0x2d,0xda,0x40,0xa2,0xaf,0xfa,0xba,0x12,0x41,
        0xd4,0x95,0x97,0x29,0x84,0x0e,0x07,0x2a,0x49,0xe8,0xdc,0x74,0x5b,0xa1,0xe2,0xa2,
        0xc5,0x3e,0xd5,0xf9,0x0e,0x1d,0xfb,0xdf,0xfa,0x66,0xe4,0x97,0x66,0x60,0x3a,0x68};
    char deciphered[AES_BLOCK_SIZE];
    int outl;

    EVP_CIPHER_CTX *ctx_dec = EVP_CIPHER_CTX_new();

    EVP_DecryptInit(ctx_dec, EVP_aes_128_ecb(),key,NULL); 
    EVP_CIPHER_CTX_set_padding(ctx_dec,0);

    if (EVP_DecryptUpdate(ctx_dec, deciphered, &outl, ciphered, AES_BLOCK_SIZE) ==0){
        printf("ERROR DECRYPTING\n");
        EVP_CIPHER_CTX_free(ctx_dec);
        return EXIT_FAILURE;
    }

    if(EVP_DecryptFinal(ctx_dec, deciphered, &outl)==0){
        printf("ERROR DECRYPTING\n");
        EVP_CIPHER_CTX_free(ctx_dec);
        return EXIT_FAILURE;
    }
    
    printf("PLAINTEXT: %s \n",deciphered);

    EVP_CIPHER_CTX_free(ctx_dec);

    return EXIT_SUCCESS;

}
